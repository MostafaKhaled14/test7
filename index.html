<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Organizational Structure</title>
    <link rel="stylesheet" href="CSS/bootstrap.min.css" />
    <link rel="stylesheet" href="CSS/all.min.css" />
    <style>
      .organizational-structure-image img {
        width: 100%;
        height: 100%;
        aspect-ratio: 4 / 2.9;
        object-fit: cover;
      }

      .organizational-structure-icon {
        position: absolute;
        bottom: 12px;
        right: 25px;
        display: flex;
        justify-content: center;
        align-items: center;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        color: white;
        background-color: green;
        transition: 0.3s;
        z-index: 10;
      }

      .organizational-structure-icon.active,
      .organizational-structure-icon:hover {
        color: green;
        background-color: white;
        box-shadow: 0 0 0 3px green;
      }

      .overlay {
        position: fixed;
        inset: 0;
        z-index: 9999;
        background: rgba(0, 0, 0, 0.6);
        display: none;
        align-items: center;
        justify-content: center;
      }

      .overlay.active {
        display: flex;
      }

      .popup-content {
        position: relative;
        width: 95%;
        height: 95%;
        border-radius: 8px;
        background-color: white;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .close-btn {
        display: flex;
        justify-content: end;
        padding: 16px;
      }

      .zoom-container {
        flex: 1;
        overflow: hidden;
        touch-action: none; /* مهم للتحكم باللمس */
      }

      .zoomed-image {
        width: 100%;
        height: 100%;
        object-fit: contain;
        transform-origin: center center;
        transition: transform 0.05s linear;
        cursor: grab;
      }
    </style>
  </head>

  <body>
    <section class="mof-organizational-structure py-5">
      <div class="container position-relative">
        <div class="organizational-structure-image">
          <img src="./img/organizational-structure.jpg" alt="organizational-structure-image" />
        </div>

        <!-- أيقونة الفتح -->
        <div class="organizational-structure-icon d-md-none" id="organizational-structure-icon">
          <i class="fa fa-link p-4"></i>
        </div>

        <!-- البوب أب -->
        <div class="overlay" id="overlay">
          <div class="popup-content">
            <div class="close-btn">
              <i class="fa fa-close"></i>
            </div>
            <div class="zoom-container">
              <img class="zoomed-image" src="./img/organizational-structure.jpg" alt="zoomed-image" />
            </div>
          </div>
        </div>
      </div>
    </section>

    <script>
      const icon = document.getElementById("organizational-structure-icon");
      const overlay = document.getElementById("overlay");
      const zoomedImg = overlay.querySelector(".zoomed-image");

      let zoom = 1,
        posX = 0,
        posY = 0,
        lastX = 0,
        lastY = 0,
        startDist = 0,
        startScale = 1,
        dragging = false;

      // فتح البوب أب
      icon.addEventListener("click", () => {
        overlay.classList.add("active");
        icon.classList.add("active");
        document.body.style.overflow = "hidden";
      });

      // غلق البوب أب
      overlay.addEventListener("click", (e) => {
        if (e.target === overlay || e.target.closest(".close-btn")) {
          overlay.classList.remove("active");
          icon.classList.remove("active");
          zoom = 1;
          posX = posY = 0;
          zoomedImg.style.transform = `translate(0,0) scale(1)`;
          document.body.style.overflow = "";
        }
      });

      // التعامل مع اللمس
      zoomedImg.addEventListener("touchstart", (e) => {
        if (e.touches.length === 1) {
          dragging = true;
          lastX = e.touches[0].clientX;
          lastY = e.touches[0].clientY;
        } else if (e.touches.length === 2) {
          dragging = false;
          const dx = e.touches[0].clientX - e.touches[1].clientX;
          const dy = e.touches[0].clientY - e.touches[1].clientY;
          startDist = Math.sqrt(dx * dx + dy * dy);
          startScale = zoom;
        }
      });

      zoomedImg.addEventListener("touchmove", (e) => {
        e.preventDefault();

        if (dragging && e.touches.length === 1 && zoom > 1) {
          const dx = e.touches[0].clientX - lastX;
          const dy = e.touches[0].clientY - lastY;
          lastX = e.touches[0].clientX;
          lastY = e.touches[0].clientY;
          posX += dx;
          posY += dy;
        } else if (e.touches.length === 2) {
          const dx = e.touches[0].clientX - e.touches[1].clientX;
          const dy = e.touches[0].clientY - e.touches[1].clientY;
          const dist = Math.sqrt(dx * dx + dy * dy);
          zoom = Math.min(Math.max(1, startScale * (dist / startDist)), 4);
        }

        requestAnimationFrame(() => {
          zoomedImg.style.transform = `translate(${posX}px, ${posY}px) scale(${zoom})`;
        });
      });

      zoomedImg.addEventListener("touchend", () => (dragging = false));
    </script>

    <script src="js/bootstrap.bundle.min.js"></script>
  </body>
</html>
